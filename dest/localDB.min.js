var localDB;!function(){"use strict";function a(){return void 0===window.localStorage?!1:!0}function b(a,b){h(o[a],function(a){a(b)})}function c(a){var b={};return h(a,function(a){b[a.index]=a}),b}function d(a){var b=a;return b=b.replace(/\s/g,""),b=b.toLowerCase()}function e(a){var b={};return h(a,function(a){b[a]=a}),b}function f(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c}function g(){var a=Date.now(),b=Math.floor(Math.random()*a-(a+1e3)+(a+1e3));return b}function h(a,b){for(var c=a.length;c--;)b(a[c],c)}var i={},j={nolocalstorage:"your browser doesn't support localstorage",schemaUndefined:"you have to defined a schema: localDB.schema(schemaname:string, schemafields:array)",schemaNameEmpty:"you have to define a name for your schema",collectionNameUndefined:"collection name dont exist",collectionNotExist:"Collection dont exist",indexUndefined:"Index is undefinded",notInSchema:"attribute not in schema define",viewCollection:"your View need a collection",noObject:"your view need an object as parameter"},k=function(){if(!a())throw j.nolocalstorage;var b={collections:function(){return q().collections()},empty:function(a){return q().empty(a)},view:function(){},schema:function(a,b){if(void 0!==a&&"string"==typeof a&&void 0!==b&&void 0!==b[0]){var c=a,e=b;if(0===c.length)throw j.schemaNameEmpty;return c=d(c),n().schema(c,e)}throw j.schemaUndefined}};return b=f(b,l()),b=f(b,p())},l=function(){function a(a){return void 0!==a&&"string"==typeof a&&q().existCollection(a)===!0?!0:!1}function c(a,b){var c=e(i[a]);for(var d in b)if(void 0===c[d])return!1;return!0}function d(a,b){var c=a;for(var d in b)c[d]instanceof Array&&c[d].push(b[d]);return c}function f(a,b){var c=a;for(var d in b)if(c[d]instanceof Array){var e=c[d].indexOf(b[d]);e>-1&&c[d].splice(e,1)}return c}function k(a,b){var c=a;for(var d in b)c[d]=b[d];return c}function l(a,b){return a!==b?!0:!1}function n(a,b){return a===b?!0:!1}function o(a,b){return parseInt(a)>parseInt(b)?!0:!1}function p(a,b){return parseInt(a)>=parseInt(b)?!0:!1}function r(a,b){return parseInt(a)<parseInt(b)?!0:!1}function s(a,b){return parseInt(a)<=parseInt(b)?!0:!1}function t(a,b){if(a instanceof Array){var c=!1;return h(a,function(a){b===a&&(c=!0)}),c}}return{add:function(c,d){if(!a(c))throw j.collectionNameUndefined;var e=i[c],f={index:g()};return h(e,function(a){f[a]=d[a]}),q().addModel(c,f),b("add",f),f},removeByIndex:function(c,d){if(!a(c))throw j.collectionNameUndefined;var e,f=q().getCollection(c);void 0!==f&&(e=f[d],delete f[d],q().save(c,f),b("remove",e))},findByIndex:function(b,c){if(void 0===c)throw j.indexUndefined;if(!a(b))throw j.collectionNameUndefined;var d=q().getCollection(b);return d[c]},findIndex:function(a,b,d){var e,f;for(var e in b)e=e,f=b[e];var g=void 0!==d?d:q().getCollection(a);if(!c(a,f))throw j.notInSchema;var h=[];for(var i in f)h.push(i),h.push(f[i]);var k=[];for(var m in g){var u=!1;switch(e){case"is":u=n(g[m][h[0]],h[1]);break;case"not":u=l(g[m][h[0]],h[1]);break;case"gt":u=o(g[m][h[0]],h[1]);break;case"gte":u=p(g[m][h[0]],h[1]);break;case"lt":u=r(g[m][h[0]],h[1]);break;case"lte":u=s(g[m][h[0]],h[1]);break;case"has":u=t(g[m][h[0]],h[1])}u&&k.push(m)}return k},find:function(a,b,c){var d=this.findIndex(a,b,c),e=q().getCollection(a),f=[];return h(d,function(a){f.push(e[a])}),m(f,a)},findAll:function(b){if(!a(b))throw j.collectionNameUndefined;var c=[],d=q().getCollection(b);for(var e in d)c.push(d[e]);return m(c,b)},remove:function(a,b){var c=this.findIndex(a,b),d=q().getCollection(a),e=this,f=[];return h(c,function(b){f.push(d[b]),e.removeByIndex(a,b)}),m(f,a)},update:function(a,b,c){var d=this.findIndex(a,b),e=this,f=[];h(d,function(b){e.updateByIndex(a,b,c)});var g=q().getCollection(a);return h(d,function(a){f.push(g[a])}),m(f,a)},updateByIndex:function(e,g,h){if(!a(e))throw j.collectionNameUndefined;if(void 0===g)throw j.indexUndefined;var i=q().getCollection(e)[g];for(var l in h){var m=h[l];if(!c(e,h[l]))throw j.notInSchema;var i;switch(l){case"set":i=k(i,m);break;case"push":i=d(i,m);break;case"pull":i=f(i,m)}}var n=q().getCollection(e);n[i.index]=i,q().save(e,n),b("update",updated)}}},m=function(a,b){var a=a,d=b;return{count:function(){return a.length},fetch:function(){return a},where:function(b){var e=c(a),f=l().find(d,b,e);return f},limit:function(b,c){return a.splice(b,c)}}},n=function(){return{schema:function(a,b){return i[a]=b,q().createCollection(a)?(i[a]=b,!0):!1}}},o={update:[],remove:[],add:[]},p=function(){return{on:function(a,b){o[a].push(b)}}},q=function(){return{empty:function(a){if(!this.existCollection(a))throw j.collectionNotExist;return this.save(a,{}),!0},collections:function(){var a={};for(var b in i){a[b]=[];var c=this.getCollection(b);for(var d in c)a[b].push(c[d])}return a},addModel:function(a,b){if(!this.existCollection(a))throw j.collectionNotExist;var c=this.getCollection(a);c[b.index]=b,this.save(a,c)},save:function(a,b){localStorage.setItem(a,JSON.stringify(b))},existCollection:function(a){return null!==localStorage.getItem(a)?!0:!1},createCollection:function(a){return this.existCollection(a)?!1:(localStorage.setItem(a,JSON.stringify({})),!0)},getCollection:function(a){return this.existCollection(a)?JSON.parse(localStorage.getItem(a)):void 0}}};localDB=new k}();
//# sourceMappingURL=localDB.min.js.map